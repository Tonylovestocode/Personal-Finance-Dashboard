<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Finance Dashboard</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <!-- React and related libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        // --- React Code Starts Here ---
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Default Categories for Expenses ---
        const CATEGORIES = ["Food", "Transport", "Bills", "Entertainment", "Shopping", "Health", "Other"];

        // --- Main App Component ---
        function App() {
            // --- State Management ---
            // Load transactions from localStorage or default to an empty array
            const [transactions, setTransactions] = useState(() => {
                const saved = localStorage.getItem('financeTrackerTransactionsV2');
                return saved ? JSON.parse(saved) : [];
            });
            
            // State for the new transaction form inputs
            const [description, setDescription] = useState('');
            const [amount, setAmount] = useState('');
            const [type, setType] = useState('expense'); // 'expense' or 'income'
            const [category, setCategory] = useState(CATEGORIES[0]);

            // --- Save data to localStorage whenever transactions change ---
            useEffect(() => {
                localStorage.setItem('financeTrackerTransactionsV2', JSON.stringify(transactions));
            }, [transactions]);

            // --- Calculations using useMemo for performance ---
            const { totalIncome, totalExpenses, spendingByCategory } = useMemo(() => {
                let income = 0;
                let expenses = 0;
                const categorySpending = {};

                for (const t of transactions) {
                    if (t.type === 'income') {
                        income += t.amount;
                    } else {
                        expenses += t.amount;
                        categorySpending[t.category] = (categorySpending[t.category] || 0) + t.amount;
                    }
                }
                return { totalIncome: income, totalExpenses: expenses, spendingByCategory: categorySpending };
            }, [transactions]);
            
            const netBalance = totalIncome - totalExpenses;

            // --- Handlers ---
            const handleAddTransaction = (e) => {
                e.preventDefault();
                const amountFloat = parseFloat(amount);
                if (!description || !amountFloat || amountFloat <= 0) {
                    alert("Please enter a valid description and positive amount.");
                    return;
                }
                const newTransaction = { id: Date.now(), description, amount: amountFloat, type, category: type === 'expense' ? category : 'Income' };
                setTransactions(prev => [newTransaction, ...prev]);
                setDescription('');
                setAmount('');
            };
            
            const handleDeleteTransaction = (id) => {
                setTransactions(prev => prev.filter(t => t.id !== id));
            };

            // --- UI Rendering ---
            return (
                <div className="min-h-screen text-gray-800">
                    <div className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-gray-900">Finance Dashboard</h1>
                            <p className="text-gray-600 mt-2">A complete overview of your income and expenses.</p>
                        </header>

                        {/* --- Financial Summary --- */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <SummaryCard title="Total Income" amount={totalIncome} color="text-green-500" />
                            <SummaryCard title="Total Expenses" amount={totalExpenses} color="text-red-500" />
                            <SummaryCard title="Net Balance" amount={netBalance} color={netBalance >= 0 ? 'text-blue-500' : 'text-red-500'} />
                        </div>

                        {/* --- Add Transaction Form --- */}
                        <div className="bg-white p-6 rounded-2xl shadow-lg mb-8">
                           <h2 className="text-xl font-bold mb-4">Add New Transaction</h2>
                           <form onSubmit={handleAddTransaction} className="space-y-4">
                               <div className="grid grid-cols-2 gap-4">
                                   <button type="button" onClick={() => setType('income')} className={`p-3 rounded-lg font-semibold transition-colors ${type === 'income' ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>Income</button>
                                   <button type="button" onClick={() => setType('expense')} className={`p-3 rounded-lg font-semibold transition-colors ${type === 'expense' ? 'bg-red-500 text-white' : 'bg-gray-200'}`}>Expense</button>
                               </div>
                               <input type="text" value={description} onChange={(e) => setDescription(e.target.value)} placeholder="Description (e.g., Salary, Groceries)" className="w-full p-3 border border-gray-300 rounded-lg" required />
                               <div className="flex flex-col sm:flex-row gap-4">
                                   <div className="relative flex-grow">
                                       <span className="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                       <input type="number" value={amount} onChange={(e) => setAmount(e.target.value)} placeholder="Amount" className="w-full p-3 pl-7 border border-gray-300 rounded-lg" required />
                                   </div>
                                   {type === 'expense' && (
                                       <select value={category} onChange={(e) => setCategory(e.target.value)} className="w-full sm:w-1/3 p-3 border border-gray-300 rounded-lg bg-white">
                                           {CATEGORIES.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                       </select>
                                   )}
                               </div>
                               <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">Add Transaction</button>
                           </form>
                        </div>
                        
                        {/* --- Visualizations and History --- */}
                        <div className="grid grid-cols-1 lg:grid-cols-5 gap-8">
                            {/* --- Spending Chart --- */}
                            <div className="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                                <h2 className="text-xl font-bold mb-4">Spending by Category</h2>
                                <SpendingChart data={spendingByCategory} />
                            </div>
                            {/* --- Transaction History --- */}
                            <div className="lg:col-span-3 bg-white p-6 rounded-2xl shadow-lg">
                               <h2 className="text-xl font-bold mb-4">Transaction History</h2>
                               <ul className="space-y-3 max-h-96 overflow-y-auto pr-2">
                                   {transactions.length > 0 ? (
                                       transactions.map(t => <TransactionItem key={t.id} transaction={t} onDelete={handleDeleteTransaction} />)
                                   ) : (
                                       <p className="text-center text-gray-500 py-4">No transactions yet.</p>
                                   )}
                               </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // --- Helper Components ---
        const SummaryCard = ({ title, amount, color }) => (
            <div className="bg-white p-6 rounded-2xl shadow-lg text-center">
                <h3 className="text-md font-medium text-gray-500">{title}</h3>
                <p className={`text-3xl font-bold mt-2 ${color}`}>
                    {new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount)}
                </p>
            </div>
        );

        const TransactionItem = ({ transaction, onDelete }) => {
            const isIncome = transaction.type === 'income';
            return (
                <li className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p className="font-bold text-gray-800">{transaction.description}</p>
                        <p className="text-sm text-gray-500">{isIncome ? 'Income' : transaction.category}</p>
                    </div>
                    <div className="flex items-center gap-4">
                        <span className={`font-mono font-semibold ${isIncome ? 'text-green-600' : 'text-red-500'}`}>
                            {isIncome ? '+' : '-'}${transaction.amount.toFixed(2)}
                        </span>
                        <button onClick={() => onDelete(transaction.id)} className="text-gray-400 hover:text-red-600 font-bold text-lg" aria-label="Delete transaction">&times;</button>
                    </div>
                </li>
            );
        };
        
        const SpendingChart = ({ data }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const hasData = Object.keys(data).length > 0;

            useEffect(() => {
                // Only try to create a chart if there is data and the canvas element exists
                if (hasData && chartRef.current) {
                    if (chartInstance.current) {
                        chartInstance.current.destroy(); // Destroy previous chart instance
                    }
                    const ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#4f46e5', '#f59e0b', '#10b981', '#ef4444', '#3b82f6', '#8b5cf6', '#64748b'],
                                hoverOffset: 4,
                            }],
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                            }
                        }
                    });
                }
                
                // Cleanup function
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data, hasData]); // Rerun effect if data or hasData changes
            
            return hasData ? <canvas ref={chartRef}></canvas> : <p className="text-center text-gray-500 py-10">No spending data to display.</p>;
        };

        // --- Render the App ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
